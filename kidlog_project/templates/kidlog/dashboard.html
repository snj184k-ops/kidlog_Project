{% extends "base.html" %} {% block content %} {% load static %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
<div class="container py-4">
    <h2 class="mb-4">{{ child.name }} ã®æˆé•·è¨˜éŒ²</h2>
    <div class="row mb-3">
        <!-- èº«é•·ãƒ»ä½“é‡å…¥åŠ› -->
        <div class="col-md-4">
            <div class="card p-3">
                <div class="card-header">
                    <h5 class="mb-0">èº«é•·ãƒ»ä½“é‡</h5>
                </div>
                <div class="card-body">
                    <form method="post" action="">
                        {% csrf_token %} {{ htmt_form.as_p }}
                        <button type="submit" class="btn btn-primary" name="htwt_record">è¿½åŠ </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- æ—¥è¨˜å…¥åŠ› -->
        <div class="col-md-4">
            <div class="card p-3">
                <div class="card-header">
                    <h5 class="mb-0">æ—¥è¨˜</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %} {{ diary_form.as_p }}
                        <button type="submit" class="btn btn-primary" name="diary_record">ç™»éŒ²</button>
                    </form>
                </div>
                <div class="card-footer">
                    <a href="{% url 'diary_list' child.id %}" class="btn btn-outline-primary btn-sm">éå»ã®æ—¥è¨˜ã‚’è¦‹ã‚‹ </a>
                </div>
            </div>
        </div>

        <!-- ä¹³å…è¨˜éŒ² -->
        <div class="col-md-4">
            <div class="card p-3">
                <div class="card-header">
                    <h5 class="mb-0">ä¹³å…è¨˜éŒ²</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}

                        <!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼é¸æŠ -->
                        <div class="mb-3">
                            <label for="category" class="form-label">ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠ</label>
                            <select id="category" class="form-select" onchange="showForm(this.value)">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="milk">æˆä¹³</option>
                            <option value="sleep">ç¡çœ </option>
                            <option value="poop">ã†ã‚“ã¡</option>
                            <option value="pee">ãŠã—ã£ã“</option>
                            <option value="temp">ä½“æ¸©</option>
                            <option value="food">é›¢ä¹³é£Ÿ</option>
                            </select>
                        </div>

                        <!-- å„ç¨®ãƒ•ã‚©ãƒ¼ãƒ  -->
                        <div id="form-milk" class="record-form d-none">
                            <h6>ğŸ¼ æˆä¹³</h6>
                            {{ milk_form.as_p }}
                        </div>
                        <div id="form-sleep" class="record-form d-none">
                            <h6>ğŸ˜´ ç¡çœ </h6>
                            {{ sleep_form.as_p }}
                        </div>
                        <div id="form-poop" class="record-form d-none">
                            <h6>ğŸ’© ã†ã‚“ã¡</h6>
                            {{ poop_form.as_p }}
                        </div>
                        <div id="form-pee" class="record-form d-none">
                            <h6>ğŸš½ ãŠã—ã£ã“</h6>
                            {{ pee_form.as_p }}
                        </div>
                        <div id="form-temp" class="record-form d-none">
                            <h6>ğŸŒ¡ï¸ ä½“æ¸©</h6>
                            {{ temp_form.as_p }}
                        </div>
                        <div id="form-food" class="record-form d-none">
                            <h6>ğŸš é›¢ä¹³é£Ÿ</h6>
                            {{ food_form.as_p }}
                        </div>

                        <div>
                            <button type="submit" class="btn btn-primary" name="infant_record">è¿½åŠ </button>
                        </div>
                    </form>
                </div>
                <div class="card-footer">
                    <a href="{% url 'baby_record_overview' child.id %}" class="btn btn-outline-primary btn-sm">ä»Šæ—¥ã®è©³ç´°ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚’è¦‹ã‚‹ </a>
                </div>
            </div>
        </div>
    </div>


    <div class="row mb-3">
        <!-- æˆé•·è¨˜éŒ²ã‚«ãƒ¼ãƒ‰ -->
        <div class="col-md-6 mb-3">
            <div class="card">
                <div class="card-header">
                    <ul class="nav nav-tabs">
                        <li class="nav-item">
                            <a class="nav-link {% if mode == 'today' %}active{% endif %}" href="?mode=today">ä»Šæ—¥</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if mode == 'week' %}active{% endif %}" href="?mode=week">é€±å¹³å‡</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if mode == 'month' %}active{% endif %}" href="?mode=month">æœˆå¹³å‡</a>
                        </li>
                    </ul>
                </div>
                <div class="card-body">
                    <ul class="list-group">
                        <li class="list-group-item">æˆä¹³: {{ record_dict.avg_milk }} ml</li>
                        <li class="list-group-item">ã†ã‚“ã¡: {{ record_dict.avg_poop }} å›</li>
                        <li class="list-group-item">ãŠã—ã£ã“: {{ record_dict.avg_pee }} å›</li>
                        <li class="list-group-item">ç¡çœ : {{ record_dict.avg_sleep }} æ™‚é–“</li>
                        <li class="list-group-item">ä½“æ¸©: {{ record_dict.avg_temp }} â„ƒ</li>
                        <li class="list-group-item">é›¢ä¹³é£Ÿ: {{ record_dict.avg_food }} å›</li>
                        <li class="list-group-item">ãƒ¡ãƒ‹ãƒ¥ãƒ¼: {{ record_dict.menu_list }}</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- AIè³ªå• -->
        <div class="col-md-6 mb-3">
            <div class="card p-3">
                <div class="card-header">
                    <h5 class="mb-0">AIè³ªå•</h5>
                </div>
                <div class="card-body">
                    <form method="post" id="aiForm" action="{% url 'ai_chat' child.id %}">
                        {% csrf_token %}
                        <textarea class="form-control mb-2" name="first_ai_question" id="question" rows="10" placeholder="è³ªå•ã‚’å…¥åŠ›â€¦"></textarea>
                        <span id="error" class="error" style="display:none">â€»å…¥åŠ›ãŒå¿…è¦ã§ã™ã€‚</span><br>
                        <button type="submit" class="btn btn-primary" name="ai_question">è³ªå•</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- æˆé•·è¨˜éŒ²ã‚°ãƒ©ãƒ• -->
        <div class="col-md-9">
            <div class="card p-3">
                <div class="card-header">
                    <h5 class="mb-0">èº«é•·ã¨ä½“é‡ã®æ¨ç§»</h5>
                </div>
                <canvas id="growthChart" height="200"></canvas>
            </div>
        </div>

        <!-- å†™çœŸè¡¨ç¤º -->
        <div class="col-md-3">
            <div class="card p-3 text-center">
                <div class="card-header">
                    <h5 class="mb-0">å†™çœŸ</h5>
                </div>
                {% if child.photo %}
                <img src="{{ child.photo.url }}" alt="{{ child.name }}" class="photo-preview"> {% else %}
                <img src="https://via.placeholder.com/400x300?text=No+Photo" alt="no photo" class="photo-preview"> {% endif %}
            </div>
        </div>
    </div>

    {{ record_dict.growth_chart|json_script:"growth-chart-data" }}

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="text/javascript" src="{% static 'js/dashboard.js' %}"></script>
    {% endblock %}